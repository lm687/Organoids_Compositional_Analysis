geom_point() +
geom_label_repel(aes(label=labels))+
ggtitle("PCA of both datasets with projection")+
labs(x=paste0('PC1 (', round(var_explained1[1], 2)*100, '%)'),
y=paste0('PC2 (', round(var_explained1[2], 2)*100, '%)'))+
theme_dark()+ theme(legend.position = "bottom")
}
}
#<end_chunk>
#<begin_chunk>```{r, pca_from_scratch,include=TRUE, echo=FALSE}
createPCA_fromscratch <- function(input_matrix, annotation, annotation2, return_df=FALSE, labels_active=TRUE){
prcomp_all_clr <- princomp(input_matrix)
df_prcomp_exposures_clr <- data.frame(prcomp_all_clr$scores[,1:2],
study=annotation,
bool_any_zeroes=annotation2,
labels=rownames(input_matrix))
df_prcomp_exposures_clr$labels[!grepl('Cell line', df_prcomp_exposures_clr$labels)] <- NA
df_prcomp_exposures_clr[,'labels'] <- gsub("Cell line ", "", df_prcomp_exposures_clr$labels)
var_explained2 <- (prcomp_all_clr$sdev**2)/sum(prcomp_all_clr$sdev**2)
if(return_df){
prcomp_all_clr
}else{
if(labels_active){
ggplot(df_prcomp_exposures_clr, aes(x=Comp.1, y=Comp.2, col=interaction(bool_any_zeroes, study), label=labels))+ geom_point() + geom_label_repel()+
labs(x=paste0('PC1 (', round(var_explained2[1], 2)*100, '%)'),
y=paste0('PC2 (', round(var_explained2[2], 2)*100, '%)'))
}else{
ggplot(df_prcomp_exposures_clr, aes(x=Comp.1, y=Comp.2, col=interaction(bool_any_zeroes, study)))+ geom_point() +
labs(x=paste0('PC1 (', round(var_explained2[1], 2)*100, '%)'),
y=paste0('PC2 (', round(var_explained2[2], 2)*100, '%)'))
}
}
}
for(i in 1:2){
print(createPCA_projectorganoids(input_matrix = rbind(natgen_clr[[i]],org_clr_robustzeroes),
annotation = c(natgen_metadata[[i]]$study, rep('Cell Line', nrow(org_clr))),
annotation2 = c(rep(FALSE, dim(natgen_metadata[[i]])[1]),
unlist(apply(org, 1, function(i) any(i == 0)))),
labels_active = TRUE)+ theme_dark()+ theme(legend.position = "bottom") +
ggtitle(paste0('PCA of both datasets with projection with robust zeroes, datatset=', i)))
print(createPCA_fromscratch(input_matrix = rbind(natgen_clr[[i]],org_clr_robustzeroes),
annotation = c(natgen_metadata[[i]]$study, rep('Cell Line', nrow(org_clr))),
annotation2 = c(rep(FALSE, dim(natgen_metadata[[i]])[1]),
unlist(apply(org, 1, function(i) any(i == 0)))),
labels_active = TRUE)+ theme_dark()+ theme(legend.position = "bottom") +
ggtitle(paste0('PCA created from scratch with robust zeroes, dataset=', i)))
}
#<end_chunk>
#<begin_text>
##' Overall, there are two groups (JB126 and 2259). All JB126 are **extremely** similar except that p22 has a non-zero exposure for 25, whereas all others have a zero exposure. Then, for 2259 there are two groups: p3 and p20 (which have a zero exposure of S6 and a non-zero exposure of S5) and p7 and p13 (opposite scenario; non-zero for S6 and zero for S5).
#<end_text>
#<begin_text>
#' ### Loadings for the PCAs
#<end_text>
#<begin_chunk>```{r, loadings, fig.height=4, echo=FALSE}
pcas_with_projection <- list()
pcas_from_scratch <- list()
for(i in 1:2){
pcas_with_projection[[i]] <- createPCA_projectorganoids(input_matrix = rbind(natgen_clr[[i]],org_clr_robustzeroes),
annotation = c(natgen_metadata[[i]]$study, rep('Cell Line', nrow(org_clr))),
annotation2 = c(rep(FALSE, dim(natgen_metadata[[i]])[1]),
unlist(apply(org, 1, function(i) any(i == 0)))),
labels_active = TRUE, return_df = TRUE)
pcas_from_scratch[[i]] <- createPCA_fromscratch(input_matrix = rbind(natgen_clr[[i]],org_clr_robustzeroes),
annotation = c(natgen_metadata[[i]]$study, rep('Cell Line', nrow(org_clr))),
annotation2 = c(rep(FALSE, dim(natgen_metadata[[i]])[1]),
unlist(apply(org, 1, function(i) any(i == 0)))),
labels_active = TRUE, return_df = TRUE)
}
par(mfrow=c(1,2))
for(i in 1:2){
barplot(pcas_with_projection[[i]]$loadings[,1], main='Loadings of the\nfirst principal component')
barplot(pcas_with_projection[[i]]$loadings[,2], main='Loadings of the\nfirst principal component')
barplot(pcas_from_scratch[[i]]$loadings[,1], main='Loadings of the\nsecond principal component')
barplot(pcas_from_scratch[[i]]$loadings[,2], main='Loadings of the\nsecond principal component')
}
#<end_chunk>
org
org_clr_robustzeroes
#<begin_chunk>```{r, dendrogram_aitchisondistance,echo=FALSE}
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
natgen_metadata
all_metadata <- rbind(natgen_metadata[[2]], organoid_metadata)
natgen_metadata[[2]]
organoid_metadata
all_metadata <- rbind(natgen_metadata[[2]], organoid_metadata$study)
all_metadata
organoid_metadata
organoid_metadata$study
natgen_metadata[[2]]
head(natgen_metadata[[2]])
all_metadata
all_metadata <- rbind(natgen_metadata[[2]], cbind(organoid_metadata$study))
all_metadata <- rbind(natgen_metadata[[2]], cbind(study=organoid_metadata$study))
all_metadata
#<begin_chunk>```{r, dendrogram_aitchisondistance,echo=FALSE}
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
all_metadata <- rbind(natgen_metadata[[2]], cbind(study=organoid_metadata$study))
all_metadata
natgen_clr
natgen_clr[[2]]
all_clr <- rbind(natgen_clr[[2]], org_clr_robustzeroes)
all_clr
all_clr
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
labels_org_bool
levels_study
(all_metadata[labels(dendro_all),'study']
)
dendro_all
labels(dendro_all)
all_clr_clean
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
labels(all_clr_clean)
labels(dendro_all)
all_metadata
all_clr
rownames(all_clr)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
rownames(all_clr)dendro_all
dendro_all
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 2
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.4, cex.lab=4, main='Dendrogram based on the exposures\n(Aitchison distance)')
idx=2
idx=1
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
natgen_metadata
natgen_metadata[[1]]
all_metadata <- rbind(natgen_metadata[[idx]]$study, cbind(study=organoid_metadata$study))
warnings()
all_metadata
natgen_metadata[[idx]]$study
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 2
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.4, cex.lab=4, main='Dendrogram based on the exposures\n(Aitchison distance)')
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
labels(dendro_all)[labels_org_bool]
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 2
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.4, cex.lab=4, main='Dendrogram based on the exposures\n(Aitchison distance)')
dev.off()
plot(dendro_all, cex=0.4, cex.lab=4, main='Dendrogram based on the exposures\n(Aitchison distance)')
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 0.2
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.1, cex.lab=0.02, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
names_prev_datasets <- c('NatGen dataset', 'New OV exposures for SNP TCGA')
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 0.2
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.1, cex.lab=0.02, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 0.2
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.1, cex.lab=0.02, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
idx
idx=1
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 0.4
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.1, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 1.1
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.1, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
cex_labels
labels(dendro_all)
labels(dendro_all) <- gsub('Cell line ', '', labels(dendro_all))
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
labels(dendro_all) <- gsub('Cell line ', '', labels(dendro_all))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 1.1
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.1, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
labels(dendro_all) <- gsub('Cell line ', '', labels(dendro_all))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 1.1
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.6, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
labels(dendro_all) <- gsub('Cell line ', '', labels(dendro_all))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 0.9
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.2, cex.main=0.7, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
for(idx in 1:2){
organoid_metadata <- cbind.data.frame(study=rep('organoids', nrow(org_clr_robustzeroes)), age=NA, age.cat=NA, stringsAsFactors=FALSE)
rownames(organoid_metadata) <- rownames(org_clr_robustzeroes)
if(idx==1){
all_metadata <- rbind(cbind(natgen_metadata[[idx]]$study), cbind(study=organoid_metadata$study))
}else{
all_metadata <- rbind(natgen_metadata[[idx]], cbind(study=organoid_metadata$study))
}
all_clr <- rbind(natgen_clr[[idx]], org_clr_robustzeroes)
rownames(all_metadata) <- rownames(all_clr)
rm_infinite <- apply(all_clr, 1, function(x) any(is.infinite(x)))
cat(which(rm_infinite), 'removed due to infinite values')
all_clr_clean <- all_clr[!rm_infinite,]
which(rm_infinite)
dendro_all <- as.dendrogram(hclust(dist(all_clr_clean)))
levels_study <- levels(factor(all_metadata[labels(dendro_all),'study']))
levels_study
which_level_organoids <- which(grepl('organoids', levels_study))
cols <- rep(NA, length(levels_study))
cols[which_level_organoids] <- '#88E9A2'
cols[-which_level_organoids] <- c('#FFA07A', '#FA8072', '#E9967A', '#F08080')
labels_colors(dendro_all) <- cols[factor(all_metadata[labels(dendro_all),'study'])]
labels_org_bool <- labels_colors(dendro_all) == '#88E9A2'
# labels(dendro_all)[labels_org_bool] <- rep('●', sum(labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep('•', sum(!labels_org_bool))
labels(dendro_all)[!labels_org_bool] <- rep(NA, sum(!labels_org_bool))
labels(dendro_all) <- gsub('Cell line ', '', labels(dendro_all))
cex_labels <- rep(1, length(labels_org_bool))
cex_labels[labels_org_bool] <- 0.9
dendro_all <- set(dendro_all, "labels_cex", cex_labels)
plot(dendro_all, cex=0.2, cex.main=1, main=paste0('Dendrogram based on the exposures\n(Aitchison distance)\n', names_prev_datasets[idx]))
}
