# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1), aes(label=Var1))
ggplot(ecDNAdcast2_forggplot[1:200,], aes(x=Var1, y=Var2, fill=value
))+geom_tile()+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(label=Var1))
ggplot(ecDNAdcast2_forggplot[1:200,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(label=Var1))
ggplot(ecDNAdcast2_forggplot[1:200,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(x=genes_interest_ecdna, y=1, value=NA), aes(label=Var1))
ggplot(ecDNAdcast2_forggplot[1:200,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(x=Var1, y=Var2, label=Var1))
ggplot(ecDNAdcast2_forggplot[1:200,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot[1:200,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank()+axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot[1:200,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -1,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = 3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())
ecDNAdcast2_forggplot$Var2
length(levels(ecDNAdcast2_forggplot$Var2))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+lims(y=(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(0.1,0))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(3,0))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(30,0))
?scale_y_discrete
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(0, 0, 0.2, 0))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(0, 0.3, 0.2, 0))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(0, 0.3, 0.2, 1))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(3, 0.3, 0.2, 1))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(1, 0, 0, 0))
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=1, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(.3, 0, 0, 0))
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 9, width = 4)
ecDNAdcast2_forggplot
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
pdf("../../figures_GRCh37/ecDNA_all_orgs_selected_genes.pdf", height = 5, width = 4)
print(pheatmap::pheatmap(log(NA_for_zero(ecDNAdcast2[genes_interest_ecdna,])+1),
cluster_rows = T, cluster_cols = T))
dev.off()
dev.off()
pdf("../../figures_GRCh37/ecDNA_all_orgs_selected_genes.pdf", height = 5, width = 4)
print(pheatmap::pheatmap(log(NA_for_zero(ecDNAdcast2[genes_interest_ecdna,])+1),
cluster_rows = T, cluster_cols = T))
dev.off()
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=0, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(.3, 0, 0, 0))
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=0, value=NA), nudge_y = -2,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(.3, 0, 0, 0))
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=0.5, value=NA), nudge_y = -2,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(.3, 0, 0, 0))
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = cbind.data.frame(Var1=genes_interest_ecdna, Var2=0.5, value=NA), nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(.3, 0, 0, 0))
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
genes_interest_ecdnalabels <- cbind.data.frame(Var1=genes_interest_ecdna, Var2=0.5, value=NA)
genes_interest_ecdna
genes_interest_ecdna
genes_interest_ecdna
rm(genes_interest_ecdnalabels)
ecDNAdcast2_forggplotlabels <- cbind.data.frame(Var1=genes_interest_ecdna, Var2=0.5, value=NA)
sapply(ecDNAdcast2_forggplotlabels$Var1, function(i) ecDNAdcast2_forggplotlabels[ecDNAdcast2_forggplotlabels$Var1 == i,])
ecDNAdcast2_forggplotlabels
sapply(ecDNAdcast2_forggplotlabels$Var1, function(i) ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,])
sapply(ecDNAdcast2_forggplotlabels$Var1, function(i) which.max(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]))
i
i=ecDNAdcast2_forggplotlabels$Var1
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,])
i
i=ecDNAdcast2_forggplotlabels$Var1[1]
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,])
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(value)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(value, decreasing=T)
?arrange
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% desc(value, decreasing=T)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% desc(value)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value))
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(1)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% select(Var2)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2)
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2) %>% as.character()
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2) %>% unlist
(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2) %>% unlist %>% as.character()
sapply(ecDNAdcast2_forggplotlabels$Var1, function(i) (ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2) %>% unlist %>% as.character())
ecDNAdcast2_forggplotlabels <- cbind.data.frame(Var1=genes_interest_ecdna, Var2=0.5, value=NA)
ecDNAdcast2_forggplotlabels$Var2 <- sapply(ecDNAdcast2_forggplotlabels$Var1, function(i) (ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2) %>% unlist %>% as.character())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
# geom_label_repel()+
# scale_fill_viridis_b()+
geom_label_repel(data = ecDNAdcast2_forggplotlabels, nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
# lims(y=c(-3, length(levels(ecDNAdcast2_forggplot$Var2))))
scale_y_discrete(
expand=c(.3, 0, 0, 0))
#   limits = ecDNAdcast2_forggplot$Var1,
#   labels = ifelse(ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna, (ecDNAdcast2_forggplot$Var1), ""))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
scale_y_discrete(
expand=c(.3, 0, 0, 0))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ecDNAdcast2_forggplot$Var2 <- factor(ecDNAdcast2_forggplot$Var2, levels=ecDNAdcast2_forggplot$Var2[phall_ecdna$tree_col$order])
phall_ecdna$tree_col$order
ecDNAdcast2_forggplot$Var2[phall_ecdna$tree_col$order]
ecDNAdcast2_forggplot <- (melt(as(log(NA_for_zero(ecDNAdcast2)+1), 'matrix')))
ecDNAdcast2_forggplot$Var1 <- factor(ecDNAdcast2_forggplot$Var1, levels=ecDNAdcast2_forggplot$Var1[phall_ecdna$tree_row$order])
ecDNAdcast2_forggplot$Var2 <- factor(ecDNAdcast2_forggplot$Var2, levels=ecDNAdcast2_forggplot$Var2[phall_ecdna$tree_col$order])
ecDNAdcast2_forggplot$Var2
ecDNAdcast2_forggplot <- (melt(as(log(NA_for_zero(ecDNAdcast2)+1), 'matrix')))
ecDNAdcast2_forggplot$Var1 <- factor(ecDNAdcast2_forggplot$Var1, levels=ecDNAdcast2_forggplot$Var1[phall_ecdna$tree_row$order])
ecDNAdcast2_forggplot$Var2 <- factor(ecDNAdcast2_forggplot$Var2, levels=unique(ecDNAdcast2_forggplot$Var2)[phall_ecdna$tree_col$order])
ecDNAdcast2_forggplotlabels <- cbind.data.frame(Var1=genes_interest_ecdna, Var2=0.5, value=NA)
ecDNAdcast2_forggplotlabels$Var2 <- sapply(ecDNAdcast2_forggplotlabels$Var1, function(i) (ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 == i,]) %>% arrange(desc(value)) %>% filter(row_number()==1) %>% dplyr::select(Var2) %>% unlist %>% as.character())
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
scale_y_discrete(
expand=c(.3, 0, 0, 0))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_point(data = ecDNAdcast2_forggplotlabels,
aes(x=Var1, y=Var2))+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
scale_y_discrete(
expand=c(.3, 0, 0, 0))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_point(data = ecDNAdcast2_forggplotlabels,
aes(x=Var1, y=Var2))+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
scale_y_discrete(
expand=c(.05, 0, 0, 0))
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_point(data = ecDNAdcast2_forggplotlabels,
aes(x=Var1, y=Var2))+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank())+
scale_y_discrete(
expand=c(.05, 0, 0, 0))+labs(fill='ln((abs CN)+1)', x='High CN region', y='PDO')
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_point(data = ecDNAdcast2_forggplotlabels,
aes(x=Var1, y=Var2))+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank(), legend.position = "bottom")+
scale_y_discrete(
expand=c(.05, 0, 0, 0))+labs(fill='ln((abs CN)+1)', x='High CN region', y='PDO')
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ggplot(ecDNAdcast2_forggplot)+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_point(data = ecDNAdcast2_forggplotlabels,
aes(x=Var1, y=Var2))+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank(), legend.position = "bottom")+
scale_y_discrete(
expand=c(.05, 0, 0, 0))+labs(fill='ln((abs CN)+1)', x='Region of high CN', y='PDO')
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot.pdf", height = 7, width = 10)
ecDNAdcast2_forggplot
ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna,]
ggplot(ecDNAdcast2_forggplot[ecDNAdcast2_forggplot$Var1 %in% genes_interest_ecdna,])+
geom_tile(aes(x=Var1, y=Var2, fill=value))+
scale_fill_viridis_b()+
geom_point(data = ecDNAdcast2_forggplotlabels,
aes(x=Var1, y=Var2))+
geom_label_repel(data = ecDNAdcast2_forggplotlabels,# nudge_y = -3,
aes(x=Var1, y=Var2, label=Var1))+
theme(axis.text.x=element_blank(), axis.ticks = element_blank(), axis.line.x.bottom =element_blank(), legend.position = "bottom")+
scale_y_discrete(
expand=c(.05, 0, 0, 0))+labs(fill='ln((abs CN)+1)', x='Region of high CN', y='PDO')
ggsave("../../figures_GRCh37/ecDNA_all_orgs_ggplot_selected_genes.pdf", height = 7, width = 10)
ggplot(ecDNA_with_position[!is.na(ecDNA_with_position$PDO),],
aes(xmin=cumposition, xmax=cumposition_end, ymin=0, ymax=CN.value, col=CN.value,
label=ifelse(CN.gene_name %in% genes_interest_ecdna, CN.gene_name, NA)))+
theme_bw()+
geom_label_repel(size=2.5, aes(x=mean(cumposition), y=CN.value))+
facet_wrap(.~PDO, drop=FALSE, ncol=1,# scales = "free_y",
strip.position="right")+geom_rect()+
theme(axis.text.x=element_blank(), axis.line.x.bottom =element_blank())+
geom_vline(xintercept = cumsum(as.numeric(max_chroms)), col='blue', lty='solid', alpha=0.2)
ggplot(ecDNA_with_position[!is.na(ecDNA_with_position$PDO),],
aes(xmin=cumposition, xmax=cumposition_end, ymin=0, ymax=CN.value, col=CN.value,
label=ifelse(CN.gene_name %in% genes_interest_ecdna, CN.gene_name, NA)))+
theme_bw()+
geom_label_repel(size=2.5, aes(x=mean(cumposition), y=CN.value))+
facet_wrap(.~PDO, drop=FALSE, ncol=1,# scales = "free_y",
strip.position="right")+geom_rect()+
theme(axis.text.x=element_blank(), axis.line.x.bottom =element_blank())+
geom_vline(xintercept = cumsum(as.numeric(max_chroms)), col='blue', lty='solid', alpha=0.2)+
labs(x='Position in the genome', y='Absolute CN')
ggsave("../../figures_GRCh37/ecDNA_all_orgs_genome.pdf", height = 7, width = 9)
ggplot(melt(amplost_summary),
aes(x=factor(PDO, levels=amplost_summary$PDO[order(amplost_summary$amp)]),
y=value, fill=variable))+
geom_bar(stat='identity')
ggplot(melt(amplost_summary),
aes(x=factor(PDO, levels=amplost_summary$PDO[order(amplost_summary$amp)]),
y=value, fill=variable))+
geom_bar(stat='identity')+  theme(axis.text.x=element_text(angle = 90, hjust = 0))
ggsave("../../figures_GRCh37/fraction_amplified_lost_genes.pdf", height = 4, width = 5)
ggplot(melt(amplost_summary),
aes(x=factor(PDO, levels=amplost_summary$PDO[order(amplost_summary$amp)]),
y=value, fill=variable))+
geom_bar(stat='identity')+  theme(axis.text.x=element_text(angle = 90, hjust = 0))+labs(x='PDO', y='Fraction', fill='Type of bin')
ggsave("../../figures_GRCh37/fraction_amplified_lost_genes.pdf", height = 4, width = 5)
brcaStatus
segments_ICGCAU <- readRDS("../../../copy_number_analysis_organoids/data/clean_segtables/segtables_ICGC_absolute_copynumber_AU.RDS")
segments_ICGCAU
## get segments from the unified version created in copy_number_analysis_organoids.Rmd
segments_organoids <- readRDS("../../../copy_number_analysis_organoids/data/absolute_CN/absoluteCN_organoid.RDS")
segments_organoids
organoids_absolute_copynumber = readRDS("data/organoid_absolute_CN.rds")
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
organoids_absolute_copynumber = readRDS("data/organoid_absolute_CN.rds")
# sampleNames(organoids_absolute_copynumber) = names_orgs$`new name`[match(gsub("org", "", sampleNames(organoids_absolute_copynumber)), names_orgs$`old name`)]
organoids_CN_features = extractCopynumberFeatures(organoids_absolute_copynumber)
source("../../../other_repos/britroc-cnsignatures-bfb69cd72c50/main_functions.R")
source("../../../other_repos/britroc-cnsignatures-bfb69cd72c50/helper_functions.R")
# sampleNames(organoids_absolute_copynumber) = names_orgs$`new name`[match(gsub("org", "", sampleNames(organoids_absolute_copynumber)), names_orgs$`old name`)]
organoids_CN_features = extractCopynumberFeatures(organoids_absolute_copynumber)
organoids_absolute_copynumber
# sampleNames(organoids_absolute_copynumber) = names_orgs$`new name`[match(gsub("org", "", sampleNames(organoids_absolute_copynumber)), names_orgs$`old name`)]
organoids_CN_features = extractCopynumberFeatures(organoids_absolute_copynumber)
organoids_absolute_copynumber
organoids_absolute_copynumber
extractCopynumberFeatures
# sampleNames(organoids_absolute_copynumber) = names_orgs$`new name`[match(gsub("org", "", sampleNames(organoids_absolute_copynumber)), names_orgs$`old name`)]
this_path = ""../../../other_repos/britroc-cnsignatures-bfb69cd72c50/"
# sampleNames(organoids_absolute_copynumber) = names_orgs$`new name`[match(gsub("org", "", sampleNames(organoids_absolute_copynumber)), names_orgs$`old name`)]
this_path = "../../../other_repos/britroc-cnsignatures-bfb69cd72c50/"
organoids_CN_features = extractCopynumberFeatures(organoids_absolute_copynumber)
organoids_CN_features
segments_ICGCAU
?extractCopynumberFeatures
extractCopynumberFeatures
getSegsize
organoids_CN_features_segtable = getSegTable(organoids_absolute_copynumber)
organoids_CN_features_segtable
organoids_CN_features_segtable[[1]]
organoids_CN_features_segtable = lapply(organoids_absolute_copynumber, getSegTable)
organoids_absolute_copynumber
ncol(organoids_absolute_copynumber)
organoids_CN_features_segtable = lapply(1:ncol(organoids_absolute_copynumber), function(i) getSegTable(organoids_absolute_copynumber[,i]))
organoids_CN_features_segtable
organoids_absolute_copynumber
names(organoids_absolute_copynumber)
sampleNames(organoids_absolute_copynumber)
renaming <- readxl::read_xls("data/matching_ascites_samples_Lena.xlsx")
renaming <- readxl::read_xlsx("data/matching_ascites_samples_Lena.xlsx")
renaming
match(paste0(renaming$CInumber, '_org'), sampleNames(organoids_absolute_copynumber))
sampleNames(organoids_absolute_copynumber)
match(paste0(renaming$CInumber, 'org'), sampleNames(organoids_absolute_copynumber))
renaming$Derived_organoid[match(sampleNames(organoids_absolute_copynumber), paste0(renaming$CInumber, 'org'))]
names(organoids_CN_features_segtable) = renaming$Derived_organoid[match(sampleNames(organoids_absolute_copynumber), paste0(renaming$CInumber, 'org'))]
organoids_CN_features_segtable
saveRDS(organoids_CN_features_segtable, "data/clean_segtables/segtables_organoids_absolute_copynumber.RDS")
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
## get segments from the unified version created in copy_number_analysis_organoids.Rmd
segments_organoids <- readRDS("../../../copy_number_analysis_organoids/data/absolute_CN/absoluteCN_organoid.RDS") ## 20220728
segments_organoids
all_segs=segments_organoids
names_not_run=names(all_segs)
sample_name_it
sample_name_it=names_not_run[1]
sample_name_it
names_not_run
all_segs
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
organoids_absolute_copynumber = readRDS("data/organoid_absolute_CN.rds")
# sampleNames(organoids_absolute_copynumber) = names_orgs$`new name`[match(gsub("org", "", sampleNames(organoids_absolute_copynumber)), names_orgs$`old name`)]
this_path = "../../../other_repos/britroc-cnsignatures-bfb69cd72c50/"
organoids_CN_features_segtable = lapply(1:ncol(organoids_absolute_copynumber), function(i) getSegTable(organoids_absolute_copynumber[,i]))
names(organoids_CN_features_segtable) = renaming$Derived_organoid[match(sampleNames(organoids_absolute_copynumber), paste0(renaming$CInumber, 'org'))]
organoids_CN_features_segtable
saveRDS(organoids_CN_features_segtable, "data/clean_segtables/segtables_organoids_absolute_copynumber.RDS")
setwd(dirname(rstudioapi::getSourceEditorContext()$path))
## get segments from the unified version created in copy_number_analysis_organoids.Rmd
segments_organoids <- readRDS("../../../copy_number_analysis_organoids/data/segtables_organoids_absolute_copynumber.RDS") ## 20220728
## get segments from the unified version created in copy_number_analysis_organoids.Rmd
segments_organoids <- readRDS("../../../copy_number_analysis_organoids/data/clean_segtables/segtables_organoids_absolute_copynumber.RDS") ## 20220728
all_segs=organoids_CN_features_segtable
all_segs=segments_organoids
names_not_run=names(all_segs)
names_not_run
sample_name_it=names_not_run[1]
CN_averages <- give_CN_per_gene(segment_arg = change_column_names(all_segs[[sample_name_it]]))
source("../../../copy_number_analysis_organoids/helper_functions_granges.R")
CN_averages <- give_CN_per_gene(segment_arg = change_column_names(all_segs[[sample_name_it]]))
